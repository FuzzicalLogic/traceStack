(function(p){function q(){Object.freeze&&Object.freeze(l);return l}function l(c){c=c||{guess:!0};var e=c.e||null;return(new l.StackTracer(c)).run(e)}function m(c){for(var e=[],d=Array.prototype.slice,a=0;a<c.length;++a){var b=c[a];void 0===b?e[a]="undefined":null===b?e[a]="null":b.constructor&&(b.constructor===Array?e[a]=3>b.length?"["+m(b)+"]":"["+m(d.call(b,0,1))+"..."+m(d.call(b,-1))+"]":b.constructor===Object?e[a]="#object":b.constructor===Function?e[a]="#function":b.constructor===String?e[a]='"'+b+'"':b.constructor===Number&&(e[a]=b))}return e.join(",")}function r(c){return eval("(function(){return function "+c+'(){this["class"].create.apply(this,arguments)}}());')}var k=function(c){function e(a,b){for(var c=a,f,e=-1,d=b.length;++e<d&&(f=b[e]);)c=c.replace(f[0],f[1]?f[1]:"");return c}function d(a,b){return b?a.split(/\r\n|[\n\r\u2028\u2029]/g).slice(0,b+1).join("\n"):a}c.create=function(a){a=a||{};var b=a.key||"stack",c=a.pre||[],f=a.parsers||[],h=a.post||function(b){return b};this.parse=a.parse||function(a,u){if(!a[b])throw new TypeError;return h(e(d(e(a[b],c),u),f).split("\n"))}};c.autodetect=function(a){if(a.stack){if(a.arguments)return"chrome";if(a.sourceURL)return"safari";if(a.number)return"ie";if(a.fileName)return"firefox";if(a.message&&a.stacktrace)return 0>a.stacktrace.indexOf("called from line")?"opera10b":"opera11";if(!a.fileName)return"chrome"}else if(a.message&&a["opera#sourceloc"])return!a.stacktrace||-1<a.message.indexOf("\n")&&a.message.split("\n").length>a.stacktrace.split("\n").length?"opera9":"opera10a";return"other"};return c.prototype["class"]=c}(r("StackParser")),n=/\r\n|[\n\r\u2028\u2029]/g,t={chrome:new k({pre:[[/^[\s\S]+?\s+at\s+/," at "]],parsers:[[/^\s+(at eval )?at\s+/gm],[/^([^\(]+?)([\n$])/gm,"{anonymous}() ($1)$2"],[/^Object.<anonymous>\s*\(([^\)]+)\)/gm,"{anonymous}() ($1)"],[/^(.+) \((.+)\)$/gm,"$1@$2"]]}),safari:new k({pre:[[/\[native code\]\n/m],[/^(?=\w+Error\:).*$\n/m]],parsers:[[/^@/gm,"{anonymous}()@"]]}),ie:new k({pre:[[/^\s*at\s+(.*)$/gm,"$1"]],parsers:[[/^Anonymous function\s+/gm,"{anonymous}() "],[/^(.+)\s+\((.+)\)$/gm,"$1@$2"]],post:function(c){return c.slice(1)}}),firefox:new k({pre:[[/(?:\n@:0)?\s+$/m]],parsers:[[/^(?:\((\S*)\))?@/gm,"{anonymous}($1)@"]],post:function(c){return c.map(function(c,d,a){return c+":"})}}),opera11:function(c,e){if(!c.stacktrace)throw new TypeError;var d,a=/^.*line (\d+), column (\d+)(?: in (.+))? in (\S+):$/,b=c.stacktrace.split(n),g=[];b.map(function(b,a,c){return 0==a%2?b:""});for(var f=0,h=b.length;f<h;f+=2)if(""!==b[f]&&(d=a.exec(b[f]))){var s=d[3]||"global code",s=s.replace(/<anonymous function: (\S+)>/,"$1").replace(/<anonymous function>/,"{anonymous}");g.push(s+"@"+d[4]+":"+d[1]+":"+d[2])}return g},opera10b:function(c,e){if(!c.stacktrace)throw new TypeError;for(var d,a=[],b=/^(.*)@(.+):(\d+)$/,g=c.stacktrace.split(n),f=-1,h=g.length;++f<h&&!(e&&a.length<e);)(d=b.exec(g[f]))&&result.push((d[1]?d[1]+"()":"global code")+"@"+d[2]+":"+d[3]+":");return result},opera10a:function(c,e){if(!c.stacktrace)throw new TypeError;var d,a=[],b=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,g=c.stacktrace.split(n);g.map(function(b,a,c){return 0==a%2?b:""});for(var f=-2,h=g.length;(f+=2)<h&&!(e&&results.length<e);)""!==g[f]&&(d=b.exec(g[f]))&&a.push((d[3]||"{anonymous}")+"()@"+d[2]+":"+d[1]+":");return a},opera9:function(c,e){if(!c.message)throw new TypeError;var d,a=[],b=c.message.split(n),g=/Line (\d+).*script (?:in )?(\S+)/i;b.map(function(b,a,c){return 0==a%2?b:""});for(var f=-2,h=b.length;(f+=2)<h&&!(e&&results.length<e);)""!==b[f]&&(d=g.exec(b[f]))&&a.push("{anonymous}()@"+d[2]+":"+d[1]+":");return a},other:function(c,e){for(var d=/function\s*([\w\-$]+)?\s*\(/i,a=[],b,g;c&&c.arguments&&10>a.length;)b=d.test(c.toString())?RegExp.$1||"{anonymous}":"{anonymous}",g=Array.prototype.slice.call(c.arguments||[]),a[a.length]=b+"("+m(g)+")",c=c.caller;return a}};l.StackTracer=function(c){function e(){try{c.undef()}catch(b){return b}}var d=k.autodetect(e()),a=t[d];c.create=function(b){b=b||{};var c=b.limit&&0<b.limit?b.limit:0,f=b.mode&&b.mode in t?b.mode:d,h=f===d?a:t[f];this.run=function(b){var a,d=b?0:3,k=c?c+d:0,l="other"===f?arguments.callee:b?b:e();try{a="function"===typeof h?h(l,k):h.parse(l,k),a=(c?a.slice(d,k):a.slice(d)).map(function(b,a,c){return new v(b)}),a.toString=function(){return this.join("\n")}}catch(m){a="traceStack may not be configured to work properly with this environment"}return a}};c.prototype={"class":c,trace:function(b,a,c){b=b||p;if(!(a in b))throw new TypeError('Cannot read property "'+a+'" of '+b);b[a]._tracer&&b[a]._tracer.stop(b,a);var d=b[a],e="function"===typeof d?d:function(a){return d};b[a]=function(){c.call(this,b[a]._tracer.run());return b[a]._instrumented.apply(this,arguments)};b[a]._tracer=this;b[a]._instrumented=e;"function"!==typeof d&&(b[a]._instrumented.original=d);return this},stop:function(a,c){a=a||p;if(!(c in a))throw new TypeError('Cannot read property "'+c+'" of '+a);var d,e=a[c];"function"===typeof e&&(d=e._instrumented)&&(a[c]="original"in d?d.original:d);return this}};return c}(r("StackTracer"));var v=function(c){c.create=function(c,d){if("string"!==typeof c&&!(c instanceof String))throw new TypeError("New StackInfo instances require a valid string.");var a=c.split("@"),b=a.pop(),a=a.join("@"),b=b.split(":"),g=b.pop();c=b.pop();this.file=b.join(":");this.line=c;this.column=g;this.func=a?a:"{anonymous}"};c.prototype["class"]=c;c.prototype.toString=function(){return"Line "+this.line+(this.column?", Column "+this.column:"")+" of "+this.file+": "+this.func};return c}(r("StackEntry"));"object"===typeof exports?module.exports=q():"function"===typeof define&&define.amd?define(q):p.traceStack=q()})(this);