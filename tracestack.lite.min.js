(function(s){function p(){Object.freeze&&Object.freeze(k);return k}function k(a){a=a||{guess:!0};var d=a.e||null;return(new k.StackTracer(a)).trace(d)}function q(a){return eval("(function(){return function "+a+"(){return this.constructor.create.apply(this,Array.prototype.slice.call(arguments))}}());")}k.monitor=function(a,d,b){function c(){d.call(this,b.trace());return g.apply(this,arguments)}function e(c){"undefined"!==typeof c&&(a=c);return a}var g;if("function"!==typeof d)throw new TypeError("Callback must be a valid function");arguments[arguments.length-1]instanceof k.StackTracer||(b=new k.StackTracer);a.stopMonitoring&&(a=a.stopMonitoring());g="function"===typeof a?a:e;Object.defineProperty(c,"stopMonitoring",{configurable:!1,value:function(){return a}});return c};var m=function(a){function d(c,a){for(var b=c,d,h=-1,l=a.length;++h<l&&(d=a[h]);)b=b.replace(d[0],d[1]?d[1]:"");return b}function b(a,b){return b?a.split(/\r\n|[\n\r\u2028\u2029]/g).slice(0,b+1).join("\n"):a}a.create=function(a){a=a||{};var e=a.key||"stack",g=a.pre||[],f=a.parsers||[],h=a.post||function(a){return a};this.parse=a.parse||function(a,c){if(!a[e])throw new TypeError;return h(d(b(d(a[e],g),c),f).split("\n"))}};a.autodetect=function(a){if(a.stack){if(a.arguments)return"chrome";if(a.sourceURL)return"safari";if(a.number)return"ie";if(a.fileName)return"firefox";if(a.message&&a.stacktrace)return 0>a.stacktrace.indexOf("called from line")?"opera10b":"opera11";if(!a.fileName)return"chrome"}else if(a.message&&a["opera#sourceloc"])return!a.stacktrace||-1<a.message.indexOf("\n")&&a.message.split("\n").length>a.stacktrace.split("\n").length?"opera9":"opera10a";return"other"};return a.prototype["class"]=a}(q("StackParser")),n=/\r\n|[\n\r\u2028\u2029]/g,r={chrome:new m({pre:[[/^[\s\S]+?\s+at\s+/," at "]],parsers:[[/^\s+(at eval )?at\s+/gm],[/^([^\(]+?)([\n$])/gm,"{anonymous}() ($1)$2"],[/^Object.<anonymous>\s*\(([^\)]+)\)/gm,"{anonymous}() ($1)"],[/^(.+) \((.+)\)$/gm,"$1@$2"]]}),safari:new m({pre:[[/\[native code\]\n/m],[/^(?=\w+Error\:).*$\n/m]],parsers:[[/^@/gm,"{anonymous}()@"]]}),ie:new m({pre:[[/^\s*at\s+(.*)$/gm,"$1"]],parsers:[[/^Anonymous function\s+/gm,"{anonymous}() "],[/^(.+)\s+\((.+)\)$/gm,"$1@$2"]],post:function(a){return a.slice(1)}}),firefox:new m({pre:[[/(?:\n@:0)?\s+$/m]],parsers:[[/^(?:\((\S*)\))?@/gm,"{anonymous}($1)@"]],post:function(a){return a.map(function(a,b,c){return a+":"})}}),opera11:function(a,d){if(!a.stacktrace)throw new TypeError;var b,c=/^.*line (\d+), column (\d+)(?: in (.+))? in (\S+):$/,e=a.stacktrace.split(n),g=[];e.map(function(a,b,d){return 0==b%2?a:""});for(var f=0,h=e.length;f<h;f+=2)if(""!==e[f]&&(b=c.exec(e[f]))){var l=b[3]||"global code",l=l.replace(/<anonymous function: (\S+)>/,"$1").replace(/<anonymous function>/,"{anonymous}");g.push(l+"@"+b[4]+":"+b[1]+":"+b[2])}return g},opera10b:function(a,d){if(!a.stacktrace)throw new TypeError;for(var b,c=[],e=/^(.*)@(.+):(\d+)$/,g=a.stacktrace.split(n),f=-1,h=g.length;++f<h&&!(d&&c.length<d);)(b=e.exec(g[f]))&&result.push((b[1]?b[1]+"()":"global code")+"@"+b[2]+":"+b[3]+":");return result},opera10a:function(a,d){if(!a.stacktrace)throw new TypeError;var b,c=[],e=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,g=a.stacktrace.split(n);g.map(function(a,b,d){return 0==b%2?a:""});for(var f=-2,h=g.length;(f+=2)<h&&!(d&&results.length<d);)""!==g[f]&&(b=e.exec(g[f]))&&c.push((b[3]||"{anonymous}")+"()@"+b[2]+":"+b[1]+":");return c},opera9:function(a,d){if(!a.message)throw new TypeError;var b,c=[],e=a.message.split(n),g=/Line (\d+).*script (?:in )?(\S+)/i;e.map(function(a,b,d){return 0==b%2?a:""});for(var f=-2,h=e.length;(f+=2)<h&&!(d&&results.length<d);)""!==e[f]&&(b=g.exec(e[f]))&&c.push("{anonymous}()@"+b[2]+":"+b[1]+":");return c}};k.StackTracer=function(a){function d(){try{a.undef()}catch(b){return b}}var b=m.autodetect(d()),c=r[b];a.create=function(a){a=a||{};var g=a.mode&&a.mode in r?a.mode:b,f=g===b?c:r[g];this.limit=a.limit&&0<a.limit?a.limit:0;this.trace=function(a){var b,c=a?0:3,e=this.limit?this.limit+c:0;a=a?a:d();try{b="function"===typeof f?f(a,e):f.parse(a,e),b="other"===g?this.limit?b.slice(0,this.limit):b:this.limit?b.slice(c,e):b.slice(c),b=b.map(function(a,b,d){return new t(a)}),b.toString=function(a){return(a?a+"\n\t":"")+this.join("\n\t")}}catch(k){b="traceStack may not be configured to work properly with this environment"}return b}};Object.defineProperties(a.prototype,{constructor:{writable:!1,configurable:!1,value:a},monitor:{enumerable:!0,configurable:!1,writable:!1,value:function(a,b){return k.monitor(a,b,this)}}});return a}(q("StackTracer"));var t=function(a){a.create=function(a){if("string"!==typeof a&&!(a instanceof String))throw new TypeError("New StackInfo instances require a valid string.");var b=a.split("@");a=b.pop();var b=b.join("@"),c=a.split(":"),e=c.pop();a=c.pop();this.file=c.join(":");this.line=a;this.column=e;this.func=b?b:"{anonymous}"};Object.defineProperty(a.prototype,"constructor",{value:a,writable:!1});a.prototype.toString=function(){return"at "+this.func+(this.file?" ("+this.file+(this.line?":"+this.line:"")+(this.line?":"+this.column:"")+")":"")};return a}(q("StackEntry"));"object"===typeof exports?module.exports=p():"function"===typeof define&&define.amd?define(p):s.traceStack=p()})(this);