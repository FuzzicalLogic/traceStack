(function(n){function p(){Object.freeze&&Object.freeze(l);return l}function l(c){c=c||{guess:!0};var f=c.e||null;return(new l.StackTracer(c)).run(f)}function q(c){return eval("(function(){return function "+c+'(){this["class"].create.apply(this,Array.prototype.slice.call(arguments))}}());')}var k=function(c){function f(b,a){for(var g=b,c,d=-1,f=a.length;++d<f&&(c=a[d]);)g=g.replace(c[0],c[1]?c[1]:"");return g}function d(b,a){return a?b.split(/\r\n|[\n\r\u2028\u2029]/g).slice(0,a+1).join("\n"):b}c.create=function(b){b=b||{};var a=b.key||"stack",c=b.pre||[],e=b.parsers||[],h=b.post||function(a){return a};this.parse=b.parse||function(b,t){if(!b[a])throw new TypeError;return h(f(d(f(b[a],c),t),e).split("\n"))}};c.autodetect=function(b){if(b.stack){if(b.arguments)return"chrome";if(b.sourceURL)return"safari";if(b.number)return"ie";if(b.fileName)return"firefox";if(b.message&&b.stacktrace)return 0>b.stacktrace.indexOf("called from line")?"opera10b":"opera11";if(!b.fileName)return"chrome"}else if(b.message&&b["opera#sourceloc"])return!b.stacktrace||-1<b.message.indexOf("\n")&&b.message.split("\n").length>b.stacktrace.split("\n").length?"opera9":"opera10a";return"other"};return c.prototype["class"]=c}(q("StackParser")),m=/\r\n|[\n\r\u2028\u2029]/g,s={chrome:new k({pre:[[/^[\s\S]+?\s+at\s+/," at "]],parsers:[[/^\s+(at eval )?at\s+/gm],[/^([^\(]+?)([\n$])/gm,"{anonymous}() ($1)$2"],[/^Object.<anonymous>\s*\(([^\)]+)\)/gm,"{anonymous}() ($1)"],[/^(.+) \((.+)\)$/gm,"$1@$2"]]}),safari:new k({pre:[[/\[native code\]\n/m],[/^(?=\w+Error\:).*$\n/m]],parsers:[[/^@/gm,"{anonymous}()@"]]}),ie:new k({pre:[[/^\s*at\s+(.*)$/gm,"$1"]],parsers:[[/^Anonymous function\s+/gm,"{anonymous}() "],[/^(.+)\s+\((.+)\)$/gm,"$1@$2"]],post:function(c){return c.slice(1)}}),firefox:new k({pre:[[/(?:\n@:0)?\s+$/m]],parsers:[[/^(?:\((\S*)\))?@/gm,"{anonymous}($1)@"]],post:function(c){return c.map(function(c,d,b){return c+":"})}}),opera11:function(c,f){if(!c.stacktrace)throw new TypeError;var d,b=/^.*line (\d+), column (\d+)(?: in (.+))? in (\S+):$/,a=c.stacktrace.split(m),g=[];a.map(function(a,c,b){return 0==c%2?a:""});for(var e=0,h=a.length;e<h;e+=2)if(""!==a[e]&&(d=b.exec(a[e]))){var r=d[3]||"global code",r=r.replace(/<anonymous function: (\S+)>/,"$1").replace(/<anonymous function>/,"{anonymous}");g.push(r+"@"+d[4]+":"+d[1]+":"+d[2])}return g},opera10b:function(c,f){if(!c.stacktrace)throw new TypeError;for(var d,b=[],a=/^(.*)@(.+):(\d+)$/,g=c.stacktrace.split(m),e=-1,h=g.length;++e<h&&!(f&&b.length<f);)(d=a.exec(g[e]))&&result.push((d[1]?d[1]+"()":"global code")+"@"+d[2]+":"+d[3]+":");return result},opera10a:function(c,f){if(!c.stacktrace)throw new TypeError;var d,b=[],a=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,g=c.stacktrace.split(m);g.map(function(a,c,b){return 0==c%2?a:""});for(var e=-2,h=g.length;(e+=2)<h&&!(f&&results.length<f);)""!==g[e]&&(d=a.exec(g[e]))&&b.push((d[3]||"{anonymous}")+"()@"+d[2]+":"+d[1]+":");return b},opera9:function(c,f){if(!c.message)throw new TypeError;var d,b=[],a=c.message.split(m),g=/Line (\d+).*script (?:in )?(\S+)/i;a.map(function(a,c,b){return 0==c%2?a:""});for(var e=-2,h=a.length;(e+=2)<h&&!(f&&results.length<f);)""!==a[e]&&(d=g.exec(a[e]))&&b.push("{anonymous}()@"+d[2]+":"+d[1]+":");return b}};l.StackTracer=function(c){function f(){try{c.undef()}catch(a){return a}}var d=k.autodetect(f()),b=s[d];c.create=function(a){a=a||{};var c=a.limit&&0<a.limit?a.limit:0;a=a.mode&&a.mode in s?a.mode:d;var e=a===d?b:s[a];this.run=function(a){var b,d=a?0:3,k=c?c+d:0;a=a?a:f();try{b="function"===typeof e?e(a,k):e.parse(a,k),b=c?b.slice(d,k):b.slice(d),b=b.map(function(a,b,c){return new u(a)}),b.toString=function(a){return(a?a+"\n\t":"")+this.join("\n\t")}}catch(l){b="traceStack may not be configured to work properly with this environment"}return b}};c.prototype={"class":c,trace:function(a,b,c){a=a||n;if(!(b in a))throw new TypeError('Cannot read property "'+b+'" of '+a);a[b]._tracer&&a[b]._tracer.stop(a,b);var d=a[b],f="function"===typeof d?d:function(a){return d};a[b]=function(){c.call(this,a[b]._tracer.run());return a[b]._instrumented.apply(this,arguments)};a[b]._tracer=this;a[b]._instrumented=f;"function"!==typeof d&&(a[b]._instrumented.original=d);return this},stop:function(a,b){a=a||n;if(!(b in a))throw new TypeError('Cannot read property "'+b+'" of '+a);var c,d=a[b];"function"===typeof d&&(c=d._instrumented)&&(a[b]="original"in c?c.original:c);return this}};return c}(q("StackTracer"));var u=function(c){c.create=function(c){if("string"!==typeof c&&!(c instanceof String))throw new TypeError("New StackInfo instances require a valid string.");var d=c.split("@");c=d.pop();var d=d.join("@"),b=c.split(":"),a=b.pop();c=b.pop();this.file=b.join(":");this.line=c;this.column=a;this.func=d?d:"{anonymous}"};c.prototype["class"]=c;c.prototype.toString=function(){return"at "+this.func+(this.file?" ("+this.file+(this.line?":"+this.line:"")+(this.line?":"+this.column:"")+")":"")};return c}(q("StackEntry"));"object"===typeof exports?module.exports=p():"function"===typeof define&&define.amd?define(p):n.traceStack=p()})(this);