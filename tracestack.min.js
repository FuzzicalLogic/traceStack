(function(r) { function u() { return h } function h(a) { a = a || { guess: !0 }; var c = a.e || null, e = !!a.guess; a = !a.mode || a.mode in l ? a.mode : void 0; c = (new h.StackTracer).run(c, a).slice(3); c = e ? v(c) : c; try { c = c.map(function(b, a, c) { return new w(b) }), c.toString = function() { return this.join("\n") } } catch (d) { c = "traceStack may not be configured to work properly with this environment" } return c } function m(a) { for (var c = [], e = Array.prototype.slice, d = 0; d < a.length; ++d) { var b = a[d]; void 0 === b ? c[d] = "undefined" : null === b ? c[d] = "null" : b.constructor && (b.constructor === Array ? c[d] = 3 > b.length ? "[" + m(b) + "]" : "[" + m(e.call(b, 0, 1)) + "..." + m(e.call(b, -1)) + "]" : b.constructor === Object ? c[d] = "#object" : b.constructor === Function ? c[d] = "#function" : b.constructor === String ? c[d] = '"' + b + '"' : b.constructor === Number && (c[d] = b)) } return c.join(",") } function v(a) { for (var c = 0; c < a.length; ++c) { var e = /^(.*?)(?::(\d+))(?::(\d+))?(?: -- .+)?$/, d = a[c], b = /\{anonymous\}\(.*\)@(.*)/.exec(d); if (b && (b = e.exec(b[1])) && (e = b[1], b = b[2], e && "undefined" !== typeof location && "http:" === location.protocol && "https:" === location.protocol && 1 !== e.indexOf(location.hostname) && b)) { var f = void 0; try { var g = e; if (!(g in n)) { var p = n, q = void 0; a: { var k = s(); if (k) try { k.open("GET", g, !1); k.send(null); q = k.responseText; break a } catch (h) { } q = "" } p[g] = q.split("\n") } f = x(n[g], b) } catch (l) { f = "getSource failed with url: " + e + ", exception: " + l.toString() } a[c] = d.replace("{anonymous}", f) } } return a } function s() { for (var a, c = [function() { return new XMLHttpRequest }, function() { return new ActiveXObject("Msxml2.XMLHTTP") }, function() { return new ActiveXObject("Msxml3.XMLHTTP") }, function() { return new ActiveXObject("Microsoft.XMLHTTP") }], e = 0; e < c.length; e++) try { return a = c[e](), s = c[e], a } catch (d) { } } function x(a, c) { for (var e = /function\s+([^(]*?)\s*\(([^)]*)\)/, d = /['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*function\b/, b = /['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*(?:eval|new Function)\b/, f = "", g, p = Math.min(c, 20), h, k = 0; k < p; ++k) if (g = a[c - k - 1], h = g.indexOf("//"), 0 <= h && (g = g.substr(0, h)), g) if (f = g + f, (g = d.exec(f)) && g[1] || (g = e.exec(f)) && g[1] || (g = b.exec(f)) && g[1]) return g[1]; return "(?)" } function t(a) { return eval("(function(){return function " + a + '(){this["class"].create.apply(this,arguments)}}());') } var n = {}, l = { chrome: function(a) { return (a.stack + "\n").replace(/^[\s\S]+?\s+at\s+/, " at ").replace(/^\s+(at eval )?at\s+/gm, "").replace(/^([^\(]+?)([\n$])/gm, "{anonymous}() ($1)$2").replace(/^Object.<anonymous>\s*\(([^\)]+)\)/gm, "{anonymous}() ($1)").replace(/^(.+) \((.+)\)$/gm, "$1@$2").split("\n").slice(0, -1) }, safari: function(a) { return a.stack.replace(/\[native code\]\n/m, "").replace(/^(?=\w+Error\:).*$\n/m, "").replace(/^@/gm, "{anonymous}()@").split("\n") }, ie: function(a) { return a.stack.replace(/^\s*at\s+(.*)$/gm, "$1").replace(/^Anonymous function\s+/gm, "{anonymous}() ").replace(/^(.+)\s+\((.+)\)$/gm, "$1@$2").split("\n").slice(1) }, firefox: function(a) { return a.stack.replace(/(?:\n@:0)?\s+$/m, "").replace(/^(?:\((\S*)\))?@/gm, "{anonymous}($1)@").split("\n") }, opera11: function(a) { var c = /^.*line (\d+), column (\d+)(?: in (.+))? in (\S+):$/; a = a.stacktrace.split("\n"); for (var e = [], d = 0, b = a.length; d < b; d += 2) { var f = c.exec(a[d]); if (f) { var g = f[4] + ":" + f[1] + ":" + f[2], f = f[3] || "global code", f = f.replace(/<anonymous function: (\S+)>/, "$1").replace(/<anonymous function>/, "{anonymous}"); e.push(f + "@" + g + " -- " + a[d + 1].replace(/^\s+/, "")) } } return e }, opera10b: function(a) { var c = /^(.*)@(.+):(\d+)$/; a = a.stacktrace.split("\n"); for (var e = [], d = 0, b = a.length; d < b; d++) { var f = c.exec(a[d]); f && e.push((f[1] ? f[1] + "()" : "global code") + "@" + f[2] + ":" + f[3]) } return e }, opera10a: function(a) { var c = /Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i; a = a.stacktrace.split("\n"); for (var e = [], d = 0, b = a.length; d < b; d += 2) { var f = c.exec(a[d]); f && e.push((f[3] || "{anonymous}") + "()@" + f[2] + ":" + f[1] + " -- " + a[d + 1].replace(/^\s+/, "")) } return e }, opera9: function(a) { var c = /Line (\d+).*script (?:in )?(\S+)/i; a = a.message.split("\n"); for (var e = [], d = 2, b = a.length; d < b; d += 2) { var f = c.exec(a[d]); f && e.push("{anonymous}()@" + f[2] + ":" + f[1] + " -- " + a[d + 1].replace(/^\s+/, "")) } return e }, other: function(a) { for (var c = /function\s*([\w\-$]+)?\s*\(/i, e = [], d, b; a && a.arguments && 10 > e.length;) d = c.test(a.toString()) ? RegExp.$1 || "{anonymous}" : "{anonymous}", b = Array.prototype.slice.call(a.arguments || []), e[e.length] = d + "(" + m(b) + ")", a = a.caller; return e } }; h.StackTracer = function(a) { function c() { try { a.undef() } catch (b) { return b } } var e = function(b) { if (b.arguments && b.stack) return "chrome"; if (b.stack) { if (b.sourceURL) return "safari"; if (b.number) return "ie"; if (b.fileName) return "firefox"; if (b.message && b.stacktrace) return 0 > b.stacktrace.indexOf("called from line") ? "opera10b" : "opera11"; if (!b.fileName) return "chrome" } else if (b.message && b["opera#sourceloc"]) return !b.stacktrace || -1 < b.message.indexOf("\n") && b.message.split("\n").length > b.stacktrace.split("\n").length ? "opera9" : "opera10a"; return "other" }(c()), d = l[e]; a.create = function() { this.run = function(b, a) { b = b ? b : c(); return a ? "other" === a ? l.other(arguments.callee) : l[a](b) : d(b) } }; a.prototype = { "class": a, trace: function(a, c, d) { a = a || r; if (!(c in a)) throw new TypeError('Cannot read property "' + c + '" of ' + a); var e = a[c]; a[c] = function() { d.call(this, h({ guess: !1 }).slice(1)); return a[c]._instrumented.apply(this, arguments) }; a[c]._instrumented = "function" === typeof e ? e : function() { return e }; "function" !== typeof e && (a[c]._instrumented.original = e); return this }, stop: function(a, c) { var d, e = a[c]; "function" === typeof e && (d = e._instrumented) && (a[c] = "original" in d ? d.original : d); return this } }; return a }(t("StackTracer")); var w = function(a) { a.create = function(a) { if ("string" !== typeof a && !(a instanceof String)) throw new TypeError("New StackInfo instances require a valid string."); var e = a.split("@"); a = e.pop(); var e = e.pop(), d = a.split(":"), b = d.pop(); a = d.pop(); this.file = d.join(":"); this.line = a; this.column = b; this.func = e }; a.prototype["class"] = a; a.prototype.toString = function() { return "Line " + this.line + ", Column " + this.column + " of " + this.file + ": " + this.func }; return a }(t("StackInfo")); "object" === typeof exports ? module.exports = h : "function" === typeof define && define.amd ? define(u) : r.traceStack = h })(this);