(function(w){function r(){Object.freeze&&Object.freeze(l);return l}function l(a){a=a||{guess:!0};var e=a.e||null;return(new l.StackTracer(a)).trace(e)}function p(a){for(var e=[],d=Array.prototype.slice,b=0;b<a.length;++b){var c=a[b];void 0===c?e[b]="undefined":null===c?e[b]="null":c.constructor&&(c.constructor===Array?e[b]=3>c.length?"["+p(c)+"]":"["+p(d.call(c,0,1))+"..."+p(d.call(c,-1))+"]":c.constructor===Object?e[b]="#object":c.constructor===Function?e[b]="#function":c.constructor===String?e[b]='"'+c+'"':c.constructor===Number&&(e[b]=c))}return e.join(",")}function v(){for(var a,e=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],d=0;d<e.length;d++)try{return a=e[d](),v=e[d],a}catch(b){}}function s(a){return eval("(function(){return function "+a+"(){return this.constructor.create.apply(this,Array.prototype.slice.call(arguments))}}());")}l.monitor=function(a,e,d){function b(){e.call(this,d.trace());return g.apply(this,arguments)}function c(b){"undefined"!==typeof b&&(a=b);return a}var g;if("function"!==typeof e)throw new TypeError("Callback must be a valid function");arguments[arguments.length-1]instanceof l.StackTracer||(d=new l.StackTracer);a.stopMonitoring&&(a=a.stopMonitoring());g="function"===typeof a?a:c;Object.defineProperty(b,"stopMonitoring",{configurable:!1,value:function(){return a}});return b};var n=function(a){function e(b,c){for(var a=b,f,e=-1,d=c.length;++e<d&&(f=c[e]);)a=a.replace(f[0],f[1]?f[1]:"");return a}function d(b,c){return c?b.split(/\r\n|[\n\r\u2028\u2029]/g).slice(0,c+1).join("\n"):b}a.create=function(b){b=b||{};var c=b.key||"stack",a=b.pre||[],f=b.parsers||[],h=b.post||function(b){return b};this.parse=b.parse||function(b,k){if(!b[c])throw new TypeError;return h(e(d(e(b[c],a),k),f).split("\n"))}};a.autodetect=function(b){if(b.stack){if(b.arguments)return"chrome";if(b.sourceURL)return"safari";if(b.number)return"ie";if(b.fileName)return"firefox";if(b.message&&b.stacktrace)return 0>b.stacktrace.indexOf("called from line")?"opera10b":"opera11";if(!b.fileName)return"chrome"}else if(b.message&&b["opera#sourceloc"])return!b.stacktrace||-1<b.message.indexOf("\n")&&b.message.split("\n").length>b.stacktrace.split("\n").length?"opera9":"opera10a";return"other"};return a.prototype["class"]=a}(s("StackParser")),q=/\r\n|[\n\r\u2028\u2029]/g,t={},u={chrome:new n({pre:[[/^[\s\S]+?\s+at\s+/," at "]],parsers:[[/^\s+(at eval )?at\s+/gm],[/^([^\(]+?)([\n$])/gm,"{anonymous}() ($1)$2"],[/^Object.<anonymous>\s*\(([^\)]+)\)/gm,"{anonymous}() ($1)"],[/^(.+) \((.+)\)$/gm,"$1@$2"]]}),safari:new n({pre:[[/\[native code\]\n/m],[/^(?=\w+Error\:).*$\n/m]],parsers:[[/^@/gm,"{anonymous}()@"]]}),ie:new n({pre:[[/^\s*at\s+(.*)$/gm,"$1"]],parsers:[[/^Anonymous function\s+/gm,"{anonymous}() "],[/^(.+)\s+\((.+)\)$/gm,"$1@$2"]],post:function(a){return a.slice(1)}}),firefox:new n({pre:[[/(?:\n@:0)?\s+$/m]],parsers:[[/^(?:\((\S*)\))?@/gm,"{anonymous}($1)@"]],post:function(a){return a.map(function(a,d,b){return a+":"})}}),opera11:function(a,e){if(!a.stacktrace)throw new TypeError;var d,b=/^.*line (\d+), column (\d+)(?: in (.+))? in (\S+):$/,c=a.stacktrace.split(q),g=[];c.map(function(b,a,c){return 0==a%2?b:""});for(var f=0,h=c.length;f<h;f+=2)if(""!==c[f]&&(d=b.exec(c[f]))){var m=d[3]||"global code",m=m.replace(/<anonymous function: (\S+)>/,"$1").replace(/<anonymous function>/,"{anonymous}");g.push(m+"@"+d[4]+":"+d[1]+":"+d[2])}return g},opera10b:function(a,e){if(!a.stacktrace)throw new TypeError;for(var d,b=[],c=/^(.*)@(.+):(\d+)$/,g=a.stacktrace.split(q),f=-1,h=g.length;++f<h&&!(e&&b.length<e);)(d=c.exec(g[f]))&&result.push((d[1]?d[1]+"()":"global code")+"@"+d[2]+":"+d[3]+":");return result},opera10a:function(a,e){if(!a.stacktrace)throw new TypeError;var d,b=[],c=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,g=a.stacktrace.split(q);g.map(function(b,a,c){return 0==a%2?b:""});for(var f=-2,h=g.length;(f+=2)<h&&!(e&&results.length<e);)""!==g[f]&&(d=c.exec(g[f]))&&b.push((d[3]||"{anonymous}")+"()@"+d[2]+":"+d[1]+":");return b},opera9:function(a,e){if(!a.message)throw new TypeError;var d,b=[],c=a.message.split(q),g=/Line (\d+).*script (?:in )?(\S+)/i;c.map(function(b,a,c){return 0==a%2?b:""});for(var f=-2,h=c.length;(f+=2)<h&&!(e&&results.length<e);)""!==c[f]&&(d=g.exec(c[f]))&&b.push("{anonymous}()@"+d[2]+":"+d[1]+":");return b},other:function(a,e){for(var d=/function\s*([\w\-$]+)?\s*\(/i,b=[],c,g,f=e&&10>e?e:10;a&&a.arguments&&b.length<f;)c=d.test(a.toString())?RegExp.$1||"{anonymous}":"{anonymous}",g=Array.prototype.slice.call(a.arguments||[]),b[b.length]=c+"("+p(g)+")@::",a=a.caller;b.length<f&&b.push("global code@::");return b}};l.StackTracer=function(a){function e(){try{a.undef()}catch(b){return b}}var d=n.autodetect(e()),b=u[d];a.create=function(a){a=a||{};var g=a.mode&&a.mode in u?a.mode:d,f=g===d?b:u[g];this.limit=a.limit&&0<a.limit?a.limit:0;this.guess="undefined"===typeof a.guess?!0:!!a.guess;this.trace=function(b){var a,c=b?0:3,d=this.limit?this.limit+c:0,l="other"===g?arguments.callee.caller.caller:b?b:e();try{a="function"===typeof f?f(l,d):f.parse(l,d),a="other"===g?this.limit?a.slice(0,this.limit):a:this.limit?a.slice(c,d):a.slice(c),a=a.map(function(a,b,c){return new x(a,this.guess)}),a.toString=function(a){return(a?a+"\n\t":"")+this.join("\n\t")}}catch(n){a="traceStack may not be configured to work properly with this environment"}return a}};Object.defineProperties(a.prototype,{constructor:{writable:!1,configurable:!1,value:a},monitor:{enumerable:!0,configurable:!1,writable:!1,value:function(a,b){return l.monitor(a,b,this)}}});return a}(s("StackTracer"));var x=function(a){function e(a){var c=a.file;a=a.line;if(c&&"undefined"!==typeof location&&("http:"===location.protocol||"https:"===location.protocol)&&1!==c.indexOf(location.hostname)&&a)try{if(!(c in t)){var e=t,f;a:{var h=v();if(h)try{h.open("GET",c,!1);h.send(null);f=h.responseText;break a}catch(m){}f=""}e[c]=f.split("\n")}return d(t[c],a)}catch(k){}return!1}function d(a,c){for(var d=/function\s+([^(]*?)\s*\(([^)]*)\)/,e=/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*function\b/,h=/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*(?:eval|new Function)\b/,m="",k,l=Math.min(c,20),n,p=0;p<l;++p)if(k=a[c-p-1],n=k.indexOf("//"),0<=n&&(k=k.substr(0,n)),k)if(m=k+m,(k=e.exec(m))&&k[1]||(k=d.exec(m))&&k[1]||(k=h.exec(m))&&k[1])return k[1];return"(?)"}a.create=function(a,c){if("string"!==typeof a&&!(a instanceof String))throw new TypeError("New StackInfo instances require a valid string.");var d=a.split("@"),f=d.pop(),d=d.join("@"),f=f.split(":"),h=f.pop();a=f.pop();this.file=f.join(":");this.line=a;this.column=h;c&&"{anonymous}()"===d?d=e(this):"{anonymous}()"===d&&(this.guess=function(){var a=e(this);this.func=a?a:"{anonymous}";delete this.guess;return this});this.func=d?d:"{anonymous}"};Object.defineProperty(a.prototype,"constructor",{value:a,writable:!1});a.prototype.toString=function(){return"at "+this.func+(this.file?" ("+this.file+(this.line?":"+this.line:"")+(this.line?":"+this.column:"")+")":"")};return a}(s("StackEntry"));"object"===typeof exports?module.exports=r():"function"===typeof define&&define.amd?define(r):w.traceStack=r()})(this);