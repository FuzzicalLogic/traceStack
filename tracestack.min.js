(function(s){function t(){Object.freeze&&Object.freeze(n);return n}function n(c){c=c||{guess:!0};var e=c.e||null;return(new n.StackTracer(c)).run(e)}function q(c){for(var e=[],d=Array.prototype.slice,a=0;a<c.length;++a){var b=c[a];void 0===b?e[a]="undefined":null===b?e[a]="null":b.constructor&&(b.constructor===Array?e[a]=3>b.length?"["+q(b)+"]":"["+q(d.call(b,0,1))+"..."+q(d.call(b,-1))+"]":b.constructor===Object?e[a]="#object":b.constructor===Function?e[a]="#function":b.constructor===String?e[a]='"'+b+'"':b.constructor===Number&&(e[a]=b))}return e.join(",")}function x(){for(var c,e=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],d=0;d<e.length;d++)try{return c=e[d](),x=e[d],c}catch(a){}}function u(c){return eval("(function(){return function "+c+'(){this["class"].create.apply(this,Array.prototype.slice.call(arguments))}}());')}var m=function(c){function e(a,b){for(var g=a,f,c=-1,e=b.length;++c<e&&(f=b[c]);)g=g.replace(f[0],f[1]?f[1]:"");return g}function d(a,b){return b?a.split(/\r\n|[\n\r\u2028\u2029]/g).slice(0,b+1).join("\n"):a}c.create=function(a){a=a||{};var b=a.key||"stack",c=a.pre||[],f=a.parsers||[],k=a.post||function(b){return b};this.parse=a.parse||function(a,h){if(!a[b])throw new TypeError;return k(e(d(e(a[b],c),h),f).split("\n"))}};c.autodetect=function(a){if(a.stack){if(a.arguments)return"chrome";if(a.sourceURL)return"safari";if(a.number)return"ie";if(a.fileName)return"firefox";if(a.message&&a.stacktrace)return 0>a.stacktrace.indexOf("called from line")?"opera10b":"opera11";if(!a.fileName)return"chrome"}else if(a.message&&a["opera#sourceloc"])return!a.stacktrace||-1<a.message.indexOf("\n")&&a.message.split("\n").length>a.stacktrace.split("\n").length?"opera9":"opera10a";return"other"};return c.prototype["class"]=c}(u("StackParser")),r=/\r\n|[\n\r\u2028\u2029]/g,v={},w={chrome:new m({pre:[[/^[\s\S]+?\s+at\s+/," at "]],parsers:[[/^\s+(at eval )?at\s+/gm],[/^([^\(]+?)([\n$])/gm,"{anonymous}() ($1)$2"],[/^Object.<anonymous>\s*\(([^\)]+)\)/gm,"{anonymous}() ($1)"],[/^(.+) \((.+)\)$/gm,"$1@$2"]]}),safari:new m({pre:[[/\[native code\]\n/m],[/^(?=\w+Error\:).*$\n/m]],parsers:[[/^@/gm,"{anonymous}()@"]]}),ie:new m({pre:[[/^\s*at\s+(.*)$/gm,"$1"]],parsers:[[/^Anonymous function\s+/gm,"{anonymous}() "],[/^(.+)\s+\((.+)\)$/gm,"$1@$2"]],post:function(c){return c.slice(1)}}),firefox:new m({pre:[[/(?:\n@:0)?\s+$/m]],parsers:[[/^(?:\((\S*)\))?@/gm,"{anonymous}($1)@"]],post:function(c){return c.map(function(c,d,a){return c+":"})}}),opera11:function(c,e){if(!c.stacktrace)throw new TypeError;var d,a=/^.*line (\d+), column (\d+)(?: in (.+))? in (\S+):$/,b=c.stacktrace.split(r),g=[];b.map(function(b,a,c){return 0==a%2?b:""});for(var f=0,k=b.length;f<k;f+=2)if(""!==b[f]&&(d=a.exec(b[f]))){var l=d[3]||"global code",l=l.replace(/<anonymous function: (\S+)>/,"$1").replace(/<anonymous function>/,"{anonymous}");g.push(l+"@"+d[4]+":"+d[1]+":"+d[2])}return g},opera10b:function(c,e){if(!c.stacktrace)throw new TypeError;for(var d,a=[],b=/^(.*)@(.+):(\d+)$/,g=c.stacktrace.split(r),f=-1,k=g.length;++f<k&&!(e&&a.length<e);)(d=b.exec(g[f]))&&result.push((d[1]?d[1]+"()":"global code")+"@"+d[2]+":"+d[3]+":");return result},opera10a:function(c,e){if(!c.stacktrace)throw new TypeError;var d,a=[],b=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,g=c.stacktrace.split(r);g.map(function(b,a,c){return 0==a%2?b:""});for(var f=-2,k=g.length;(f+=2)<k&&!(e&&results.length<e);)""!==g[f]&&(d=b.exec(g[f]))&&a.push((d[3]||"{anonymous}")+"()@"+d[2]+":"+d[1]+":");return a},opera9:function(c,e){if(!c.message)throw new TypeError;var d,a=[],b=c.message.split(r),g=/Line (\d+).*script (?:in )?(\S+)/i;b.map(function(b,a,c){return 0==a%2?b:""});for(var f=-2,k=b.length;(f+=2)<k&&!(e&&results.length<e);)""!==b[f]&&(d=g.exec(b[f]))&&a.push("{anonymous}()@"+d[2]+":"+d[1]+":");return a},other:function(c,e){for(var d=/function\s*([\w\-$]+)?\s*\(/i,a=[],b,g,f=e&&10>e?e:10;c&&c.arguments&&a.length<f;)b=d.test(c.toString())?RegExp.$1||"{anonymous}":"{anonymous}",g=Array.prototype.slice.call(c.arguments||[]),a[a.length]=b+"("+q(g)+")@::",c=c.caller;a.length<f&&a.push("global code@::");return a}};n.StackTracer=function(c){function e(){try{c.undef()}catch(b){return b}}var d=m.autodetect(e()),a=w[d];c.create=function(b){b=b||{};var c="undefined"===typeof b.guess?!0:!!b.guess,f=b.limit&&0<b.limit?b.limit:0,k=b.mode&&b.mode in w?b.mode:d,l=k===d?a:w[k];this.run=function(b){var a,d=b?0:3,p=f?f+d:0,m="other"===k?arguments.callee.caller.caller:b?b:e();try{a="function"===typeof l?l(m,p):l.parse(m,p),a="other"===k?f?a.slice(0,f):a:f?a.slice(d,p):a.slice(d),a=a.map(function(b,a,f){return new y(b,c)}),a.toString=function(b){return(b?b+"\n\t":"")+this.join("\n\t")}}catch(n){a="traceStack may not be configured to work properly with this environment"}return a}};c.prototype={"class":c,trace:function(b,a,c){b=b||s;if(!(a in b))throw new TypeError('Cannot read property "'+a+'" of '+b);b[a]._tracer&&b[a]._tracer.stop(b,a);var d=b[a],e="function"===typeof d?d:function(a){return d};b[a]=function(){c.call(this,b[a]._tracer.run());return b[a]._instrumented.apply(this,arguments)};b[a]._tracer=this;b[a]._instrumented=e;"function"!==typeof d&&(b[a]._instrumented.original=d);return this},stop:function(a,c){a=a||s;if(!(c in a))throw new TypeError('Cannot read property "'+c+'" of '+a);var f,d=a[c];"function"===typeof d&&(f=d._instrumented)&&(a[c]="original"in f?f.original:f);return this}};return c}(u("StackTracer"));var y=function(c){function e(a){var b=a.file;a=a.line;if(b&&"undefined"!==typeof location&&("http:"===location.protocol||"https:"===location.protocol)&&1!==b.indexOf(location.hostname)&&a)try{if(!(b in v)){var c=v,f;a:{var e=x();if(e)try{e.open("GET",b,!1);e.send(null);f=e.responseText;break a}catch(l){}f=""}c[b]=f.split("\n")}return d(v[b],a)}catch(h){}return!1}function d(a,b){for(var c=/function\s+([^(]*?)\s*\(([^)]*)\)/,d=/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*function\b/,e=/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*(?:eval|new Function)\b/,l="",h,m=Math.min(b,20),n,p=0;p<m;++p)if(h=a[b-p-1],n=h.indexOf("//"),0<=n&&(h=h.substr(0,n)),h)if(l=h+l,(h=d.exec(l))&&h[1]||(h=c.exec(l))&&h[1]||(h=e.exec(l))&&h[1])return h[1];return"(?)"}c.create=function(a,b){if("string"!==typeof a&&!(a instanceof String))throw new TypeError("New StackInfo instances require a valid string.");var c=a.split("@"),d=c.pop(),c=c.join("@"),d=d.split(":"),k=d.pop();a=d.pop();this.file=d.join(":");this.line=a;this.column=k;b&&"{anonymous}()"===c?c=e(this):"{anonymous}()"===c&&(this.guess=function(){var a=e(this);this.func=a?a:"{anonymous}";delete this.guess;return this});this.func=c?c:"{anonymous}"};c.prototype["class"]=c;c.prototype.toString=function(){return"at "+this.func+(this.file?" ("+this.file+(this.line?":"+this.line:"")+(this.line?":"+this.column:"")+")":"")};return c}(u("StackEntry"));"object"===typeof exports?module.exports=t():"function"===typeof define&&define.amd?define(t):s.traceStack=t()})(this);